{
  "info": {
    "_postman_id": "careflow-Erh",
    "name": "CareFlow EHR API - Role Based",
    "description": "Complete CareFlow API organized by user roles (Admin, Doctor, Infirmier, Secretary, Patient)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{currentToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "currentToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": ""
    },
    {
      "key": "doctorToken",
      "value": ""
    },
    {
      "key": "infirmierToken",
      "value": ""
    },
    {
      "key": "secretaryToken",
      "value": ""
    },
    {
      "key": "patientToken",
      "value": ""
    },
    {
      "key": "refreshToken",
      "value": ""
    },
    {
      "key": "patientId",
      "value": ""
    },
    {
      "key": "appointmentId",
      "value": ""
    },
    {
      "key": "medicalRecordId",
      "value": ""
    },
    {
      "key": "consultationId",
      "value": ""
    },
    {
      "key": "userId",
      "value": ""
    },
    {
      "key": "doctorUserId",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "üîê Setup & Authentication",
      "item": [
        {
          "name": "Register (Patient)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "    if(jsonData.user && jsonData.user.id) {",
                  "        pm.collectionVariables.set('userId', jsonData.user.id);",
                  "    }",
                  "    console.log('Patient registered and token saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"John Patient\",\n  \"email\": \"patient@careflow.com\",\n  \"password\": \"Patient123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "Login - Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('adminToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "    pm.collectionVariables.set('userId', jsonData.user.id);",
                  "    console.log('‚úÖ Admin logged in, token saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@careflow.com\",\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login - Doctor",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('doctorToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('doctorUserId', jsonData.user.id);",
                  "    console.log('‚úÖ Doctor logged in');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"doctor@careflow.com\",\n  \"password\": \"Doctor123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login - Infirmier",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('infirmierToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    console.log('‚úÖ Infirmier logged in');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"infirmier@careflow.com\",\n  \"password\": \"Nurse123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login - Secretary",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('secretaryToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    console.log('‚úÖ Secretary logged in');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"secretary@careflow.com\",\n  \"password\": \"Secretary123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login - Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "    console.log('‚úÖ Patient logged in');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"patient@careflow.com\",\n  \"password\": \"Patient123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{currentToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/profile",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "profile"]
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('currentToken', jsonData.accessToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{refreshToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/refresh-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "refresh-token"]
            }
          }
        },
        {
          "name": "Request Password Reset",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"patient@careflow.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/request-reset",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "request-reset"]
            }
          }
        },
        {
          "name": "Reset Password",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"RESET_TOKEN_HERE\",\n  \"newPassword\": \"NewPassword123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "reset-password"]
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{currentToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "üë®‚Äçüíº ADMIN Tests",
      "description": "Full access to all endpoints",
      "item": [
        {
          "name": "Switch to Admin Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('currentToken', pm.collectionVariables.get('adminToken'));",
                  "console.log('‚úÖ Switched to Admin token');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Create User (Doctor)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    if(jsonData.user && jsonData.user.id) {",
                  "        pm.collectionVariables.set('doctorUserId', jsonData.user.id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Dr. Ahmed Hassan\",\n  \"email\": \"doctor@careflow.com\",\n  \"password\": \"Doctor123!\",\n  \"role\": \"doctor\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "users"]
            }
          }
        },
        {
          "name": "Create User (Infirmier)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Sara Alami\",\n  \"email\": \"infirmier@careflow.com\",\n  \"password\": \"Nurse123!\",\n  \"role\": \"infirmier\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "users"]
            }
          }
        },
        {
          "name": "Create User (Secretary)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Fatima Zohra\",\n  \"email\": \"secretary@careflow.com\",\n  \"password\": \"Secretary123!\",\n  \"role\": \"secretary\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "users"]
            }
          }
        },
        {
          "name": "Create Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Youssef\",\n  \"lastName\": \"Cherif\",\n  \"dateOfBirth\": \"1985-03-20\",\n  \"contact\": \"+212612345678\",\n  \"insurance\": \"CNSS\",\n  \"allergies\": [\"Penicillin\"],\n  \"medicalHistory\": [\"Diabetes\"],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Get All Patients",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Update Patient",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Youssef\",\n  \"lastName\": \"Cherif Updated\",\n  \"dateOfBirth\": \"1985-03-20\",\n  \"contact\": \"+212612345678\",\n  \"insurance\": \"CNOPS\",\n  \"allergies\": [\"Penicillin\", \"Latex\"],\n  \"medicalHistory\": [\"Diabetes\", \"Hypertension\"],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients", "{{patientId}}"]
            }
          }
        },
        {
          "name": "Get All Medical Records",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "medical-records"]
            }
          }
        },
        {
          "name": "Delete Medical Record",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records/{{medicalRecordId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "medical-records", "{{medicalRecordId}}"]
            }
          }
        },
        {
          "name": "Delete Consultation",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations/{{consultationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations", "{{consultationId}}"]
            }
          }
        },
        {
          "name": "Delete Patient",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients", "{{patientId}}"]
            }
          }
        },
        {
          "name": "Delete Appointment",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "üë®‚Äç‚öïÔ∏è DOCTOR Tests",
      "description": "Doctor endpoints - create patients, manage medical records, consultations",
      "item": [
        {
          "name": "Switch to Doctor Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('currentToken', pm.collectionVariables.get('doctorToken'));",
                  "console.log('‚úÖ Switched to Doctor token');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Create Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Amina\",\n  \"lastName\": \"El Fassi\",\n  \"dateOfBirth\": \"1992-07-15\",\n  \"contact\": \"+212698765432\",\n  \"insurance\": \"CNOPS\",\n  \"allergies\": [\"Aspirin\"],\n  \"medicalHistory\": [\"Asthma\"],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Get All Patients",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Update Patient",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Amina\",\n  \"lastName\": \"El Fassi Updated\",\n  \"dateOfBirth\": \"1992-07-15\",\n  \"contact\": \"+212698765432\",\n  \"insurance\": \"CNOPS\",\n  \"allergies\": [\"Aspirin\", \"Peanuts\"],\n  \"medicalHistory\": [\"Asthma\"],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients", "{{patientId}}"]
            }
          }
        },
        {
          "name": "Create Appointment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('appointmentId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-20\",\n  \"heure\": \"09:00\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Get All Appointments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Complete Appointment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}", "complete"]
            }
          }
        },
        {
          "name": "Create Medical Record",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('medicalRecordId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"patientInfo\": {\n    \"name\": \"Amina El Fassi\",\n    \"age\": 32,\n    \"gender\": \"female\",\n    \"contact\": \"+212698765432\",\n    \"insurance\": \"CNOPS\"\n  },\n  \"allergies\": [\"Aspirin\"],\n  \"medicalHistory\": [\"Asthma\"],\n  \"currentMedications\": [\"Ventolin Inhaler\"],\n  \"labResults\": [\n    {\n      \"title\": \"Chest X-Ray\",\n      \"result\": \"Normal\",\n      \"date\": \"2025-10-20\"\n    }\n  ],\n  \"notes\": \"Patient presents with mild asthma symptoms. Prescribed inhaler.\",\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "medical-records"]
            }
          }
        },
        {
          "name": "Get Medical Records by Patient",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records/patient/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "medical-records",
                "patient",
                "{{patientId}}"
              ]
            }
          }
        },
        {
          "name": "Update Medical Record",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientInfo\": {\n    \"name\": \"Amina El Fassi\",\n    \"age\": 32,\n    \"gender\": \"female\",\n    \"contact\": \"+212698765432\",\n    \"insurance\": \"CNOPS\"\n  },\n  \"allergies\": [\"Aspirin\", \"Peanuts\"],\n  \"medicalHistory\": [\"Asthma\"],\n  \"currentMedications\": [\"Ventolin Inhaler\", \"Montelukast\"],\n  \"labResults\": [\n    {\n      \"title\": \"Chest X-Ray\",\n      \"result\": \"Normal\",\n      \"date\": \"2025-10-20\"\n    }\n  ],\n  \"notes\": \"Patient condition improving. Continue treatment.\",\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records/{{medicalRecordId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "medical-records", "{{medicalRecordId}}"]
            }
          }
        },
        {
          "name": "Create Consultation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('consultationId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"appointmentId\": \"{{appointmentId}}\",\n  \"patientId\": \"{{patientId}}\",\n  \"medicalRecordId\": \"{{medicalRecordId}}\",\n  \"vitalSigns\": {\n    \"bloodPressure\": \"118/76\",\n    \"heartRate\": 68,\n    \"temperature\": 36.7,\n    \"weight\": 65,\n    \"height\": 168,\n    \"respiratoryRate\": 16,\n    \"oxygenSaturation\": 98\n  },\n  \"diagnosis\": \"Asthme l√©ger contr√¥l√©. Continuer traitement actuel.\",\n  \"procedures\": [\"Auscultation pulmonaire\", \"Examen physique\"],\n  \"notes\": \"Patiente bien contr√¥l√©e sous traitement. RDV de suivi dans 3 mois.\",\n  \"status\": \"completed\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations"]
            }
          }
        },
        {
          "name": "Get My Consultations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations/doctor/{{doctorUserId}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "consultations",
                "doctor",
                "{{doctorUserId}}"
              ]
            }
          }
        },
        {
          "name": "Update Consultation",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"diagnosis\": \"Asthme l√©ger. Ajustement du traitement.\",\n  \"notes\": \"Augmenter dosage si sympt√¥mes persistent.\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations/{{consultationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations", "{{consultationId}}"]
            }
          }
        },
        {
          "name": "Complete Consultation",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{doctorToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations/{{consultationId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "consultations",
                "{{consultationId}}",
                "complete"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üë©‚Äç‚öïÔ∏è INFIRMIER Tests",
      "description": "Nurse endpoints - manage patients, appointments, view consultations",
      "item": [
        {
          "name": "Switch to Infirmier Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('currentToken', pm.collectionVariables.get('infirmierToken'));",
                  "console.log('‚úÖ Switched to Infirmier token');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Create Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Karim\",\n  \"lastName\": \"Benjelloun\",\n  \"dateOfBirth\": \"1978-11-05\",\n  \"contact\": \"+212677889900\",\n  \"insurance\": \"CNSS\",\n  \"allergies\": [],\n  \"medicalHistory\": [\"Hypertension\"],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Get All Patients",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Create Appointment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('appointmentId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-21\",\n  \"heure\": \"10:30\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Update Appointment",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-21\",\n  \"heure\": \"11:00\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}"]
            }
          }
        },
        {
          "name": "Get All Appointments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Cancel Appointment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}", "cancel"]
            }
          }
        },
        {
          "name": "View Consultations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - Create Medical Record",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"notes\": \"Should fail - Infirmier cannot create medical records\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "medical-records"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - Complete Appointment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{infirmierToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}", "complete"]
            }
          }
        }
      ]
    },
    {
      "name": "üë©‚Äçüíº SECRETARY Tests",
      "description": "Secretary endpoints - manage patients and appointments",
      "item": [
        {
          "name": "Switch to Secretary Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('currentToken', pm.collectionVariables.get('secretaryToken'));",
                  "console.log('‚úÖ Switched to Secretary token');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Create Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('patientId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Laila\",\n  \"lastName\": \"Idrissi\",\n  \"dateOfBirth\": \"1995-05-10\",\n  \"contact\": \"+212655443322\",\n  \"insurance\": \"CNOPS\",\n  \"allergies\": [\"Latex\"],\n  \"medicalHistory\": [],\n  \"consent\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Get All Patients",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "Create Appointment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('appointmentId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-22\",\n  \"heure\": \"14:00\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Get All Appointments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Update Appointment",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-22\",\n  \"heure\": \"15:30\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}"]
            }
          }
        },
        {
          "name": "Cancel Appointment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}", "cancel"]
            }
          }
        },
        {
          "name": "Delete Appointment",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - Update Patient",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Updated Name\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients", "{{patientId}}"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - View Consultations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{secretaryToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations"]
            }
          }
        }
      ]
    },
    {
      "name": "üë§ PATIENT Tests",
      "description": "Patient endpoints - view own data, create appointments",
      "item": [
        {
          "name": "Switch to Patient Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('currentToken', pm.collectionVariables.get('patientToken'));",
                  "console.log('‚úÖ Switched to Patient token');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Get My Profile",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/profile",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "profile"]
            }
          }
        },
        {
          "name": "Create Appointment (for myself)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('appointmentId', jsonData._id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"doctorId\": \"{{doctorUserId}}\",\n  \"date\": \"2025-11-25\",\n  \"heure\": \"09:30\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"]
            }
          }
        },
        {
          "name": "Get My Appointments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments?patientId={{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments"],
              "query": [
                {
                  "key": "patientId",
                  "value": "{{patientId}}"
                }
              ]
            }
          }
        },
        {
          "name": "Cancel My Appointment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/appointments/{{appointmentId}}/cancel",
              "host": ["{{baseUrl}}"],
              "path": ["api", "appointments", "{{appointmentId}}", "cancel"]
            }
          }
        },
        {
          "name": "Get My Medical Records",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/medical-records/patient/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "medical-records",
                "patient",
                "{{patientId}}"
              ]
            }
          }
        },
        {
          "name": "Get My Consultations",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/consultations/patient/{{patientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "consultations", "patient", "{{patientId}}"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - Create Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Test\",\n  \"lastName\": \"Patient\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        },
        {
          "name": "‚ùå SHOULD FAIL - Get All Patients",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{patientToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/patients",
              "host": ["{{baseUrl}}"],
              "path": ["api", "patients"]
            }
          }
        }
      ]
    }
  ]
}
